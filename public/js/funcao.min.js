$(document).ready((function(){function buscaNotas(){$(".carregando").html('<div style="width: 1.5rem; height: 1.5rem;" class="spinner-border" role="status"><span class="sr-only">Loading...</span></div>'),$(".btnBuscaNotas").prop("disabled",!0);var datas={company:"",start_end_date:"",document_template:"",issuer:"",doc_key:"",issuer_cnpj:""};$(".buscaNotas").each((function(){datas[$(this).attr("name")]=$(this).val()})),$.ajax({url:"buscaNotas",type:"POST",data:datas,success:data=>{$("#div_table_notas").removeClass("d-none"),$("#table_notas").dataTable().fnClearTable(),$("#table_notas").dataTable().fnDestroy(),$("#table_notas").DataTable({responsive:!0,lengthChange:!1,autoWidth:!1,order:[[6,"desc"]],buttons:["copy","csv","colvis"],data:data,columns:[{data:"doc_key"},{data:"button"},{data:"document_template"},{data:"grade_series"},{data:"note_number"},{data:"amount"},{data:"issue_date"},{data:"issuer_cnpj"},{data:"issuer_name"},{data:"issuer_state"},{data:"recipient_cnpj"},{data:"recipient_name"},{data:"recipient_state"}]}).buttons().container().appendTo("#table_notas_wrapper .col-md-6:eq(0)"),$(".carregando").empty(),$(".btnBuscaNotas").prop("disabled",!1)}})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".select2").select2(),$(".date-mask").daterangepicker({singleDatePicker:!1,showDropdowns:!0,locale:{format:"DD/MM/YYYY",daysOfWeek:["dom","seg","ter","qua","qui","sex","sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","outubro","Novembro","Dezembro"],applyLabel:"Aplicar",cancelLabel:"Cancelar"}}),$(document).on("change",".buscaNotas",(function(){"true"==$(this).attr("data-autoBusca")&&(buscaNotas(),$("#notasRefresh").removeClass("d-none"))})),$(document).on("click",".btnBuscaNotas",(function(){buscaNotas()})),$("#notasRefresh").on("click",(function(){var company_id=$('[name="company"]').val(),user_id=$("#user_id").val();""!==company_id&&(Swal.fire({title:"Baixando NFES",html:"Aguarde enquanto as notas estão sendo baixadas.",allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{Swal.showLoading()}}),$.ajax({url:"/downloadNFE/"+company_id+"/"+user_id,type:"GET",success:data=>{Swal.fire({icon:"success",title:"NFES Baixados",timer:3e3}),setTimeout(()=>{Swal.fire({title:"Baixando CTES",html:"Aguarde enquanto as notas estão sendo baixadas.",allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{Swal.showLoading()}}),$.ajax({url:"/downloadCTE/"+company_id+"/"+user_id,type:"GET",success:data=>{Swal.fire({icon:"success",title:"CTES Baixados",timer:3e3})},error:err=>{}})},3e3)},error:err=>{}}))})),$(document).on("click",".btn-save",(function(){let save_target=$(this).data("save_target"),save_route=$(this).data("save_route"),update_table=$(this).data("update_table");$(save_target).find("input").removeClass("is-invalid"),$(save_target).find(".invalid-feedback").remove();let modal=$(save_target).parent();modal.is(".modal-content")&&modal.append('<div class="overlay d-flex justify-content-center align-items-center"><i class="fas fa-2x fa-sync fa-spin"></i></div>'),$.ajax({url:save_route,type:"POST",data:new FormData($(save_target)[0]),cache:!1,contentType:!1,processData:!1,success:data=>{$(modal).find(".overlay").remove(),$(modal).parent().parent().modal("hide"),$(save_target).find('input[type="text"]').val(""),"S"==update_table&&data.table_tr&&$("table tbody").append(data.table_tr),Swal.fire({toast:!0,icon:"success",title:"Os dados foram salvos com successo!",showConfirmButton:!1,timer:1500})},error:err=>{$(modal).find(".overlay").remove();let erro_tags=err.responseJSON.errors;$.each(erro_tags,(key,value)=>{let tag=$(save_target).find('[name="'+key+'"]');tag.addClass("is-invalid"),tag.parent().append('<div class="invalid-feedback">'+value[0]+"</div>")}),err.responseJSON.msg_alert&&Swal.fire({icon:err.responseJSON.icon_alert,text:err.responseJSON.msg_alert})}})})),$(document).on("click",".btn-disable",(function(){let disable_name=$(this).data("disable_name"),disable_id=$(this).data("disable_id"),type_disabled=$(this).data("type_disabled"),save_route=$(this).data("save_route");var isValid=!0;type_disabled?disable_id||(isValid=!1,Swal.fire({icon:"error",title:'"disable_id" vazio!'})):(isValid=!1,Swal.fire({icon:"error",title:'"type_disabled" vazio!'}));let title="";switch(type_disabled){case"S":title='Ativar "'+disable_name+'"?';break;case"N":title='Desativar "'+disable_name+'"?';break;case"X":title='Excluir Permanentemente "'+disable_name+'"?'}isValid&&Swal.fire({icon:"info",title:title,showCancelButton:!0,confirmButtonText:"SIM",cancelButtonText:"NÃO",showLoaderOnConfirm:!0,preConfirm:disabled=>$.ajax({url:save_route,type:"POST",data:{id:disable_id,type:type_disabled}}).then(response=>($("table tbody").find(".tr-id-"+response).remove(),response)).catch(error=>{Swal.showValidationMessage(error.responseJSON)})}).then(result=>{result.isConfirmed})}))}));